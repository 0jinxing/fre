"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const arrayfy=e=>e?Array.isArray(e)?e:[e]:[],isSame=(e,t)=>e.type===t.type||typeof e.type==typeof t.type,isNew=(e,t)=>n=>"children"!==n&&"key"!==n&&e[n]!==t[n];function hashfy(e){let t={},n=0;return arrayfy(e).forEach(e=>{let r=((e||{}).props||{}).key;r?t["."+r]=e:(t["."+n]=e)&&n++}),t}function merge(e,t){let n={};for(var r in e)n[r]=e[r];for(var r in t)n[r]=t[r];return n}const defer="function"==typeof Promise?e=>Promise.resolve().then(e):setTimeout;function h(e,t){let n=[],r=[],o=arguments.length;for(;o-- >2;)n.push(arguments[o]);for(;n.length;){let e=n.pop();if(e&&e.pop)for(o=e.length;o--;)n.push(e[o]);else null===e||!0===e||!1===e?e={type:()=>{}}:"function"==typeof e?r=e:r.push("object"==typeof e?e:{type:"text",props:{nodeValue:e}})}return{type:e,props:merge(t,{children:r}),key:t&&t.key}}function updateProperty(e,t,n,r){if("style"===t)for(key in r){let n=r&&r[key]?r[key]:"";e[t][key]=n}else"o"===t[0]&&"n"===t[1]?(t=t.slice(2).toLowerCase(),n&&e.removeEventListener(t,n),e.addEventListener(t,r)):e.setAttribute(t,r)}function updateElement(e,t,n){Object.keys(n).filter(isNew(t,n)).forEach(r=>{"value"===r||"nodeValue"===r?e[r]=n[r]:updateProperty(e,r,t[r],n[r])})}function createElement(e){const t="text"===e.type?document.createTextNode(""):document.createElement(e.type);return updateElement(t,[],e.props),t}let cursor=0;function update(e,t,n){const r=this?this:getWIP();n=t?t(r.state[e],n):n,r.state[e]=n,scheduleWork(r)}function resetCursor(){cursor=0}function useState(e){return useReducer(null,e)}function useReducer(e,t){let n=getWIP();if(!n)return[t,o];let r="$"+cursor,o=update.bind(n,r,e);cursor++;let s=n.state||{};return r in s?[s[r],o]:(n.state[r]=t,[t,o])}function useEffect(e,t){let n=getWIP();n&&(n.effect=useMemo(e,t))}function useMemo(e,t){return()=>{let n=getWIP();if(n){let r=!t||(n.oldInputs||[]).some((e,n)=>t[n]!==e);!t||t.length||n.isMounted||(r=!0,n.isMounted=!0),r&&e(),n.oldInputs=t}}}function createContext(e={}){let t={};return{context:e,update:e=>{for(let n in t)t[n](e)},subscribe:(e,n)=>{n in t||(t[n]=e)},set:t}}function useContext(e){const[t,n]=useState(e.context),r=getWIP().type.name;return e.subscribe(n,r),[t,e.update]}const options={},[HOST,HOOK,ROOT,PLACE,REPLACE,UPDATE,DELETE]=[0,1,2,3,4,5,6];let updateQueue=[],nextWork=null,pendingCommit=null,currentFiber=null;function render(e,t){scheduleWork({tag:ROOT,base:t,props:{children:e}})}function scheduleWork(e){updateQueue.push(e),defer(workLoop)}function workLoop(){if(!nextWork&&updateQueue.length){const e=updateQueue.shift();if(!e)return;nextWork=e}for(;nextWork;)nextWork=performWork(nextWork);pendingCommit&&(options.commitWork?options.commitWork(pendingCommit):commitWork(pendingCommit))}function performWork(e){if(e.tag==HOOK?updateHOOK(e):updateHost(e),e.child)return e.child;for(;e;){if(completeWork(e),e.sibling)return e.sibling;e=e.parent}}function updateHost(e){options.end||e.base||(e.base=createElement(e));let t=e.parent||{};e.insertPoint=t.oldPoint,t.oldPoint=e,reconcileChildren(e,e.props.children)}function updateHOOK(e){e.props=e.props||{},e.state=e.state||{},currentFiber=e,resetCursor();const t=e.type(e.props);reconcileChildren(e,t),currentFiber.patches=e.patches}function fiberize(e,t){return t.children=hashfy(e)}function reconcileChildren(e,t){const n=e.children,r=fiberize(t,e);let o={};for(let t in n){let s=r[t],i=n[t];s&&isSame(s,i)?o[t]=i:(i.patchTag=DELETE,e.patches.push(i))}let s=null,i=null;for(let t in r){let n=r[t],u=o[t];u?isSame(u,n)&&(i=createFiber(u,{patchTag:UPDATE}),options.end||(n.patchTag=UPDATE),(n=merge(i,n)).alternate=i,u.key&&(n.patchTag=REPLACE)):n=createFiber(n,{patchTag:PLACE}),r[t]=n,n.parent=e,s?s.sibling=n:e.child=n,s=n}s&&(s.sibling=null)}function createFiber(e,t){return t.tag="function"==typeof e.type?HOOK:HOST,e.props=e.props||{nodeValue:e.nodeValue},merge(e,t)}function completeWork(e){!options.end&&e.parent?e.parent.patches=(e.parent.patches||[]).concat(e.patches||[],e.patchTag?[e]:[]):pendingCommit=e}function commitWork(e){e.patches.forEach(e=>commit(e)),nextWork=pendingCommit=null}function commit(e){let t=e.parent;for(;t.tag==HOOK;)t=t.parent;const n=t.base;let r=e.base||e.child.base;const{insertPoint:o,patchTag:s}=e;if(e.tag==HOOK)e.effect&&e.effect(),s==DELETE&&n.removeChild(r);else if(s==UPDATE)updateElement(r,e.alternate.props,e.props);else if(s==DELETE)n.removeChild(r);else{let e=o?s==PLACE?o.base.nextSibling:o.base.nextSibling||n.firstChild:null;if(e==r)return;n.insertBefore(r,e)}t.patches=e.patches=[]}function getWIP(){return currentFiber||null}exports.createContext=createContext,exports.createElement=h,exports.h=h,exports.options=options,exports.render=render,exports.scheduleWork=scheduleWork,exports.useContext=useContext,exports.useEffect=useEffect,exports.useMemo=useMemo,exports.useReducer=useReducer,exports.useState=useState;